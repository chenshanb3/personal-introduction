{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"\u8fd0\u7ef4\u77e5\u8bc6\u5206\u4eab\u5e93 \u8b66\u544a \u672c\u4ed3\u5e93\u4e3a\u5f00\u6e90\u4ed3\u5e93\uff0c\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u770b\u5230\u4ed3\u5e93\u91cc\u7684\u6587\u4ef6\uff0c\u8bf7\u52a1\u5fc5 \u8131\u654f \u540e\u518d\u4e0a\u4f20\u6587\u4ef6 \u3002 \u672c\u7f51\u7ad9\u662f\u4f9d\u8d56 Material for MkDocs \u642d\u5efa\u7684\u7ecf\u9a8c\u5206\u4eab\u7f51\u7ad9 \u6211\u7406\u89e3\u7684\u8fd0\u7ef4\uff0c\u8fd0\u7528\u5404\u79cd\u89c4\u8303\u5316\u7684\u6d41\u7a0b\u3001\u5236\u5ea6\u3001\u6587\u6863\u548c\u6280\u672f\u624b\u6bb5\uff0c\u5bf9\u8f6f\u786c\u8fd0\u884c\u73af\u5883\u3001\u4e1a\u52a1\u7cfb\u7edf\u548c\u8fd0\u7ef4\u4eba\u5458\u8fdb\u884c\u7684\u7efc\u5408\u7ba1\u7406\u3002\u5f88\u5c11\u6709\u9ad8\u6821\u628a\u8fd0\u7ef4\u5f53\u4f5c\u4e00\u4e2a\u4e13\u4e1a\uff0c \u80fd\u5165\u8fd9\u884c\uff0c\u8981\u4e48\u524d\u8f88\u6307\u70b9\uff0c\u8981\u4e48\u638f\u94b1\u57f9\u8bad\uff0c\u66f4\u591a\u7684\u8fd8\u662f\u9700\u8981\u81ea\u5df1\u53bb\u94bb\u7814\uff0c\u53bb\u5b66\u4e60\u3002\u4ece\u624b\u52a8\u8fd0\u7ef4\u5230\u81ea\u52a8\u5316\u8fd0\u7ef4\u518d\u5230\u667a\u80fd\u8fd0\u7ef4\uff0c\u884c\u4e1a\u8981\u6c42\u8d8a\u6765\u8d8a\u5377\uff0c\u4e24\u7ea7\u5206\u5316\u8d8a\u6765\u5927\u3002 \u8fd0\u7ef4\u53ea\u6709\u5728\u4e00\u6b21\u6b21\u6545\u969c\u4e2d\u624d\u80fd\u5f97\u5230\u6210\u957f\uff0c\u7136\u800c\u7a77\u6781\u4e00\u751f\u53c8\u80fd\u9047\u5230\u591a\u5c11\u6b21\u6545\u969c\u3002 \u5e0c\u671b\u80fd\u6709\u4e00\u4e2a\u8fd0\u7ef4\u6545\u969c\u6536\u96c6\u7684\u7f51\u7ad9\uff0c\u5927\u5bb6\u53ef\u4ee5\u5728\u8fd9\u91cc\u5206\u4eab\u81ea\u5df1\u9047\u5230\u7684\u7591\u96be\u6742\u75c7\uff0c\u9047\u5230\u8fc7\u7684\u5c31\u5f53 \u6e29\u6545\u77e5\u65b0 \uff0c\u6ca1\u6709\u9047\u5230\u5c31 \u5bf9\u53f7\u5165\u5ea7 \uff0c\u5927\u5bb6\u63a2\u8ba8\u5404\u79cd\u8fd0\u7ef4\u6280\u672f\u3001 \u624b\u6bb5\uff0c\u6bd5\u7adf\u5f88\u591a\u4e1c\u897f\uff0c\u7a77\u6781\u4e00\u751f\u90fd\u5b66\u4e0d\u5b8c\uff0c\u6709\u4e9b\u95ee\u9898\u3001\u6280\u672f\u53ef\u80fd\u4e00\u8f88\u5b50\u90fd\u4e0d\u4f1a\u9047\u5230\uff0c\u5f00\u62d3\u4e00\u4e0b\u5927\u5bb6\u7684\u89c6\u91ce\u3002","title":"\u6b22\u8fce"},{"location":"opsbasis/","text":"\u4ec0\u4e48\u662f\u8fd0\u7ef4 \u8fd0\u7ef4\u662f\u6307\u8fd0\u7ef4\u90e8\u95e8\u91c7\u7528\u76f8\u5173\u7684\u65b9\u6cd5\u3001\u624b\u6bb5\u3001\u6280\u672f\u3001\u5236\u5ea6\u3001\u6d41\u7a0b\u548c\u6587\u6863\u7b49\uff0c\u5bf9\u8fd0\u884c\u73af\u5883\uff08\u8f6f\u786c\u4ef6\u73af\u5883\u3001\u7f51\u7edc\u73af\u5883\u7b49\uff09\u3001\u4e1a\u52a1\u7cfb\u7edf\u548c\u8fd0\u7ef4\u4eba\u5458\u8fdb\u884c\u7efc\u5408\u7ba1\u7406\u3002","title":"\u6982\u8ff0"},{"location":"opsbasis/geoip/","text":"\u524d\u8a00 \u00b6 \u76f8\u4fe1\u5927\u5bb6\u4e5f\u90fd\u770b\u5230\u4e86\uff0c\u5982\u4eca\u7f51\u7edc\u4e16\u754c\u201c\u52a8\u8361\u4e0d\u5b89\u201d\uff0c\u5404\u56fd\u4e4b\u95f4\u7684\u4e89\u6597\u65e9\u5df2\u5728\u4e92\u8054\u7f51\u91cc\u5c55\u5f00\u3002\u54b1\u4e5f\u4e0d\u662f\u4e13\u4e1a\u7684\uff0c\u5728\u6211\u4eec\u4ec5\u6709\u7684\u5b89\u5168\u6280\u672f\u6c34\u5e73\u4e0a\uff0c\u80fd\u4e0d\u80fd\u505a\u4e9b\u529b\u6240\u80fd\u53ca\u7684\u5b89\u5168\u63aa\u65bd\u3002\u56e0\u4e3a\u6211\u7684\u7cfb\u7edf\u90fd\u662f\u901a\u8fc7nginx\u4ee3\u7406\u51fa\u53bb\u8bbf\u95ee\u7684\uff0c\u6240\u4ee5\u6211\u5c31\u60f3\u80fd\u4e0d\u901a\u8fc7nginx\u9650\u5236\u4f7f\u7528\u533a\u57df\uff0c\u6bd4\u5982\u975e\u5927\u9646\u7684IP\u65e0\u6cd5\u8bbf\u95ee\u6211\u4eec\u7684\u7cfb\u7edf\u3002 \u51c6\u5907\u5de5\u4f5c \u00b6 \u5b89\u88c5\u6269\u5c55 yum install libmaxminddb-devel -y nginx \u6e90\u7801 ngx_http_geoip2_module \u6a21\u5757 geoip2\u6700\u65b0\u7684IP\u5e93 \u6211\u8fd9\u91cc\u4ee5tengine\u4e3a\u4f8b\uff0c\u7f16\u8bd1\u9700\u8981\u7684\u5305\u6211\u90fd\u653e\u5728\u6211\u7684\u4ed3\u5e93\u91cc\u4e86\uff0c\u5927\u5bb6\u53ef\u4ee5\u81ea\u884c\u4e0b\u8f7d\uff1a https://github.com/chenshanb3/static.git \u5f00\u59cb\u7f16\u8bd1 \u00b6 \u5982\u679c\u4f60\u4e4b\u524d\u5df2\u7ecf\u4f7f\u7528\u4e86nginx/tengine\uff0c\u6700\u597d\u5148\u770b\u770b\u4e4b\u524d\u7684\u7f16\u8bd1\u53c2\u6570\uff0c\u505a\u5230\u517c\u5bb9\uff0c\u8fdb\u5165\u4e4b\u524d\u7f16\u8bd1\u7684\u76ee\u5f55\uff08objs\uff09 \u67e5\u8be2\u5f53\u65f6\u7684\u4e00\u4e2a\u7f16\u8bd1\u53c2\u6570(configure arguments) 1 nginx -V \u5c06ngx_http_geoip2_module \u6a21\u5757\u653e\u5230\u670d\u52a1\u5668\u4e0a\uff0c\u5e76\u8d4b\u4e88755\u3001777\u6743\u9650 \u5728\u6211\u4eec\u63a5\u4e0b\u6765\u7684\u7f16\u8bd1\u4e2d\u9700\u8981\u5e26\u4e0a\u4e0a\u9762\u7684\u53c2\u6570\uff0c\u5728\u8fd9\u4e9b\u53c2\u6570\u7684\u57fa\u7840\u4e0a\u518d\u52a0\u4e0a\uff1a 1 --add-module = /opt/ngx_http_geoip2_module \u7f16\u8bd1\u8fc7\u7a0b\u6ca1\u6709\u62a5\u9519\u5c31\u7ee7\u7eed\u6267\u884c 1 make && make install \u5f00\u59cb\u914d\u7f6e \u00b6 \u5728\u5b89\u88c5\u5b8c\u6210\u4ee5\u540e\uff0c\u4f1a\u5728\u7cfb\u7edf\u751f\u6210/usr/share/GeoIP/\u76ee\u5f55\uff1a \u91cc\u9762\u6709\u9ed8\u8ba4\u7684IP\u5730\u5740\u5e93\uff0c\u4e00\u4e2aipv4\u7684\uff0c\u4e00\u4e2aipv6\u7684\uff0c\u4f46\u662f\u6211\u4eec\u9700\u8981\u6700\u65b0\u7684\uff0c\u6211\u5df2\u7ecf\u4e0b\u8f7d\u597d\u4e86\uff0c\u5728\u4ed3\u5e93\u91cc\u81ea\u884c\u4e0b\u8f7d \u7136\u540e\u5728\u670d\u52a1\u5668\u4e0a\u89e3\u538b\uff0c\u653e\u5728\u4efb\u610f\u76ee\u5f55\uff0c\u6211\u8fd9\u91cc\u653e\u5728/data/tengine/GeoIP/\u76ee\u5f55\u4e0b \u63a5\u4e0b\u6765\u9700\u8981\u914d\u7f6e\u4e00\u4e0bnginx.conf\u7684\u6587\u4ef6\uff0c\u5728http\u6a21\u5757\u91cc\u6dfb\u52a0\u83b7\u53d6IP\u533a\u57df\u7684\u51fd\u6570 1 2 3 4 5 6 7 8 9 10 11 12 13 14 http { ... # \u7981\u6b62\u56fd\u5916ip\u8fdb\u884c\u8bbf\u95ee geoip2 /data/tengine/GeoIP/GeoLite2-Country.mmdb { auto_reload 5m ; $geoip2_data_country_code country iso_code ; } map $geoip2_data_country_code $allowed_country { default no ; CN yes ; } ... } \u914d\u7f6e\u597d\u4e86\u4ee5\u540e\u5c31\u53ef\u4ee5\u5728\u6211\u4eec\u81ea\u5df1\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u76f4\u63a5\u5f15\u7528\u4e86 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 server { listen 50001 ; server_name localhost ; if ( $allowed_country = no ) { # return https://www.baidu.com; return 404 ; } location / { proxy_set_header Host $host : $server_port ; proxy_set_header X-Real-IP $remote_addr ; proxy_set_header REMOTE-HOST $remote_addr ; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for ; proxy_pass http://127.0.0.1:1024 ; } } \u5982\u679c\u60f3\u653e\u5f00\u9999\u6e2f\u7684\u5730\u5740\uff0c\u53ef\u4ee5\u6539\u4e3a 1 2 3 4 5 map $geoip2_data_country_code $allowed_country { default no ; CN yes ; HK yes ; } \u5176\u4ed6\u5730\u533a\u7684\u53ef\u4ee5\u6309\u9700\u653e\u5f00\uff0c\u4f1a\u79d1\u5b66\u4e0a\u7f51\u7684\u53ef\u4ee5\u6d4b\u8bd5\u4e00\u4e0b\uff0c\u6211\u4eec\u7684\u7cfb\u7edf\u5df2\u7ecf\u7981\u6b62\u975e\u5927\u9646\u7684IP\u8bbf\u95ee\u4e86 \u603b\u7ed3 \u00b6 \u6211\u4eec\u4e5f\u4e0d\u662f\u4e13\u4e1a\u7684\u5b89\u5168\u4eba\u5458\uff0c\u4ee5\u4e0a\u64cd\u4f5c\u53ea\u80fd\u9632\u6b62\u56fd\u5916\u7684\u4eba\u8bbf\u95ee\u6211\u4eec\u7684\u7cfb\u7edf\uff0c\u5e76\u4e0d\u80fd\u505a\u5230\u76f4\u63a5\u7981\u6389\u7aef\u53e3\uff0c\u6240\u4ee5\u4e0d\u77e5\u9053\u6709\u6ca1\u6709\u7528\uff0c\u53ea\u80fd\u5fc3\u91cc\u5b89\u6170\u81ea\u5df1\u6709\u5927\u7528\u3002","title":"\u9650\u5236\u8bbf\u95eeIP"},{"location":"opsbasis/geoip/#_1","text":"\u76f8\u4fe1\u5927\u5bb6\u4e5f\u90fd\u770b\u5230\u4e86\uff0c\u5982\u4eca\u7f51\u7edc\u4e16\u754c\u201c\u52a8\u8361\u4e0d\u5b89\u201d\uff0c\u5404\u56fd\u4e4b\u95f4\u7684\u4e89\u6597\u65e9\u5df2\u5728\u4e92\u8054\u7f51\u91cc\u5c55\u5f00\u3002\u54b1\u4e5f\u4e0d\u662f\u4e13\u4e1a\u7684\uff0c\u5728\u6211\u4eec\u4ec5\u6709\u7684\u5b89\u5168\u6280\u672f\u6c34\u5e73\u4e0a\uff0c\u80fd\u4e0d\u80fd\u505a\u4e9b\u529b\u6240\u80fd\u53ca\u7684\u5b89\u5168\u63aa\u65bd\u3002\u56e0\u4e3a\u6211\u7684\u7cfb\u7edf\u90fd\u662f\u901a\u8fc7nginx\u4ee3\u7406\u51fa\u53bb\u8bbf\u95ee\u7684\uff0c\u6240\u4ee5\u6211\u5c31\u60f3\u80fd\u4e0d\u901a\u8fc7nginx\u9650\u5236\u4f7f\u7528\u533a\u57df\uff0c\u6bd4\u5982\u975e\u5927\u9646\u7684IP\u65e0\u6cd5\u8bbf\u95ee\u6211\u4eec\u7684\u7cfb\u7edf\u3002","title":"\u524d\u8a00"},{"location":"opsbasis/geoip/#_2","text":"\u5b89\u88c5\u6269\u5c55 yum install libmaxminddb-devel -y nginx \u6e90\u7801 ngx_http_geoip2_module \u6a21\u5757 geoip2\u6700\u65b0\u7684IP\u5e93 \u6211\u8fd9\u91cc\u4ee5tengine\u4e3a\u4f8b\uff0c\u7f16\u8bd1\u9700\u8981\u7684\u5305\u6211\u90fd\u653e\u5728\u6211\u7684\u4ed3\u5e93\u91cc\u4e86\uff0c\u5927\u5bb6\u53ef\u4ee5\u81ea\u884c\u4e0b\u8f7d\uff1a https://github.com/chenshanb3/static.git","title":"\u51c6\u5907\u5de5\u4f5c"},{"location":"opsbasis/geoip/#_3","text":"\u5982\u679c\u4f60\u4e4b\u524d\u5df2\u7ecf\u4f7f\u7528\u4e86nginx/tengine\uff0c\u6700\u597d\u5148\u770b\u770b\u4e4b\u524d\u7684\u7f16\u8bd1\u53c2\u6570\uff0c\u505a\u5230\u517c\u5bb9\uff0c\u8fdb\u5165\u4e4b\u524d\u7f16\u8bd1\u7684\u76ee\u5f55\uff08objs\uff09 \u67e5\u8be2\u5f53\u65f6\u7684\u4e00\u4e2a\u7f16\u8bd1\u53c2\u6570(configure arguments) 1 nginx -V \u5c06ngx_http_geoip2_module \u6a21\u5757\u653e\u5230\u670d\u52a1\u5668\u4e0a\uff0c\u5e76\u8d4b\u4e88755\u3001777\u6743\u9650 \u5728\u6211\u4eec\u63a5\u4e0b\u6765\u7684\u7f16\u8bd1\u4e2d\u9700\u8981\u5e26\u4e0a\u4e0a\u9762\u7684\u53c2\u6570\uff0c\u5728\u8fd9\u4e9b\u53c2\u6570\u7684\u57fa\u7840\u4e0a\u518d\u52a0\u4e0a\uff1a 1 --add-module = /opt/ngx_http_geoip2_module \u7f16\u8bd1\u8fc7\u7a0b\u6ca1\u6709\u62a5\u9519\u5c31\u7ee7\u7eed\u6267\u884c 1 make && make install","title":"\u5f00\u59cb\u7f16\u8bd1"},{"location":"opsbasis/geoip/#_4","text":"\u5728\u5b89\u88c5\u5b8c\u6210\u4ee5\u540e\uff0c\u4f1a\u5728\u7cfb\u7edf\u751f\u6210/usr/share/GeoIP/\u76ee\u5f55\uff1a \u91cc\u9762\u6709\u9ed8\u8ba4\u7684IP\u5730\u5740\u5e93\uff0c\u4e00\u4e2aipv4\u7684\uff0c\u4e00\u4e2aipv6\u7684\uff0c\u4f46\u662f\u6211\u4eec\u9700\u8981\u6700\u65b0\u7684\uff0c\u6211\u5df2\u7ecf\u4e0b\u8f7d\u597d\u4e86\uff0c\u5728\u4ed3\u5e93\u91cc\u81ea\u884c\u4e0b\u8f7d \u7136\u540e\u5728\u670d\u52a1\u5668\u4e0a\u89e3\u538b\uff0c\u653e\u5728\u4efb\u610f\u76ee\u5f55\uff0c\u6211\u8fd9\u91cc\u653e\u5728/data/tengine/GeoIP/\u76ee\u5f55\u4e0b \u63a5\u4e0b\u6765\u9700\u8981\u914d\u7f6e\u4e00\u4e0bnginx.conf\u7684\u6587\u4ef6\uff0c\u5728http\u6a21\u5757\u91cc\u6dfb\u52a0\u83b7\u53d6IP\u533a\u57df\u7684\u51fd\u6570 1 2 3 4 5 6 7 8 9 10 11 12 13 14 http { ... # \u7981\u6b62\u56fd\u5916ip\u8fdb\u884c\u8bbf\u95ee geoip2 /data/tengine/GeoIP/GeoLite2-Country.mmdb { auto_reload 5m ; $geoip2_data_country_code country iso_code ; } map $geoip2_data_country_code $allowed_country { default no ; CN yes ; } ... } \u914d\u7f6e\u597d\u4e86\u4ee5\u540e\u5c31\u53ef\u4ee5\u5728\u6211\u4eec\u81ea\u5df1\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u76f4\u63a5\u5f15\u7528\u4e86 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 server { listen 50001 ; server_name localhost ; if ( $allowed_country = no ) { # return https://www.baidu.com; return 404 ; } location / { proxy_set_header Host $host : $server_port ; proxy_set_header X-Real-IP $remote_addr ; proxy_set_header REMOTE-HOST $remote_addr ; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for ; proxy_pass http://127.0.0.1:1024 ; } } \u5982\u679c\u60f3\u653e\u5f00\u9999\u6e2f\u7684\u5730\u5740\uff0c\u53ef\u4ee5\u6539\u4e3a 1 2 3 4 5 map $geoip2_data_country_code $allowed_country { default no ; CN yes ; HK yes ; } \u5176\u4ed6\u5730\u533a\u7684\u53ef\u4ee5\u6309\u9700\u653e\u5f00\uff0c\u4f1a\u79d1\u5b66\u4e0a\u7f51\u7684\u53ef\u4ee5\u6d4b\u8bd5\u4e00\u4e0b\uff0c\u6211\u4eec\u7684\u7cfb\u7edf\u5df2\u7ecf\u7981\u6b62\u975e\u5927\u9646\u7684IP\u8bbf\u95ee\u4e86","title":"\u5f00\u59cb\u914d\u7f6e"},{"location":"opsbasis/geoip/#_5","text":"\u6211\u4eec\u4e5f\u4e0d\u662f\u4e13\u4e1a\u7684\u5b89\u5168\u4eba\u5458\uff0c\u4ee5\u4e0a\u64cd\u4f5c\u53ea\u80fd\u9632\u6b62\u56fd\u5916\u7684\u4eba\u8bbf\u95ee\u6211\u4eec\u7684\u7cfb\u7edf\uff0c\u5e76\u4e0d\u80fd\u505a\u5230\u76f4\u63a5\u7981\u6389\u7aef\u53e3\uff0c\u6240\u4ee5\u4e0d\u77e5\u9053\u6709\u6ca1\u6709\u7528\uff0c\u53ea\u80fd\u5fc3\u91cc\u5b89\u6170\u81ea\u5df1\u6709\u5927\u7528\u3002","title":"\u603b\u7ed3"},{"location":"opsbasis/https/","text":"\u524d\u8a00 \u00b6 HTTP\u534f\u8bae\u662f\u8d85\u6587\u672c\u4f20\u8f93\u534f\u8bae\u7684\u7f29\u5199\uff0c\u82f1\u6587\u662fHyper Text Transfer Protocol\u3002\u5b83\u662f\u4eceWEB\u670d\u52a1\u5668\u4f20\u8f93\u8d85\u6587\u672c\u6807\u8bb0\u8bed\u8a00(HTML)\u5230\u672c\u5730\u6d4f\u89c8\u5668\u7684\u4f20\u9001\u534f\u8bae\uff0cHTTP\u4fe1\u606f\u662f\u660e\u6587\u4f20\u8f93\uff0cHTTPS\u5219\u662f\u5177\u6709\u5b89\u5168\u6027\u7684ssl/tls\u52a0\u5bc6\u4f20\u8f93\u534f\u8bae\u3002HTTP\u7684\u8fde\u63a5\u5f88\u7b80\u5355\uff0c\u662f\u65e0\u72b6\u6001\u7684\uff1bHTTPS\u534f\u8bae\u662f\u7531SSL/TLS+HTTP\u534f\u8bae\u6784\u5efa\u7684\u53ef\u8fdb\u884c\u52a0\u5bc6\u4f20\u8f93\u3001\u8eab\u4efd\u8ba4\u8bc1\u7684\u7f51\u7edc\u534f\u8bae\uff0c\u6bd4HTTP\u534f\u8bae\u5b89\u5168\uff0c\u5b98\u65b9\u6587\u6863\u5df2\u7ecf\u6709\u5207\u6362HTTPS\u7684\u6307\u5bfc\u624b\u518c\u4e86 http\u5207\u6362https ,\u6211\u4e3a\u4ec0\u4e48\u4f1a\u5728\u8fd9\u91cc\u591a\u6b64\u4e00\u4e3e\u5462\uff0c\u662f\u56e0\u4e3a\u4f7f\u7528\u670d\u52a1\u5668\u751f\u6210\u7684\u8bc1\u4e66\u5728\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u6d4f\u89c8\u5668\u4f1a\u63d0\u793a\u4e0d\u5b89\u5168\uff0c\u8bc1\u4e66\u4e0d\u53ef\u4fe1\uff0c\u5177\u4f53\u7684\u539f\u56e0\u53ef\u4ee5\u81ea\u884c\u641c\u7d22\u4e00\u4e0b\uff08\u53ef\u4fe1\u7684CA\u673a\u6784\uff09\u3002 \u4eca\u5929\u5728\u8fd9\u91cc\u5c31\u4ecb\u7ecd\u4e00\u6b3e\u5b89\u5168\u3001\u53ef\u88ab\u6d4f\u89c8\u5668\u4fe1\u4efb\u7684\u8bc1\u4e66\uff1aLet\u2019s Encrypt\u514d\u8d39\u8bc1\u4e66 \u51c6\u5907\u5de5\u4f5c \u00b6 \u4e00\u53f0\u53ef\u4ee5\u8bbf\u95ee\u4e92\u8054\u7f51\u7684\u670d\u52a1\u5668\uff08\u6700\u4f4e\u914d\u7f6e\uff1a2C/2G\uff09 \u7533\u8bf7\u8bc1\u4e66 \u00b6 1. \u5b89\u88c5snapd \u00b6 1 sudo yum install epel-release -y 1 sudo yum install snapd -y 1 sudo systemctl enable --now snapd.socket 1 2 sudo service snapd start sudo ln -s /var/lib/snapd/snap /snap 2. \u5b89\u88c5certbot \u00b6 1 sudo snap install core 1 sudo snap refresh core 1 sudo snap install --classic certbot 1 sudo ln -s /snap/bin/certbot /usr/bin/certbot \u81f3\u6b64certbot\u5b89\u88c5\u5df2\u5b8c\u6210\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u7533\u8bf7\u8bc1\u4e66\u4e86 3. \u8bc1\u4e66\u7533\u8bf7 \u00b6 \u8fd9\u662f\u4f7f\u7528\u7684\u662f\u6cdb\u89e3\u6790\u57df\u540d\uff0c\u586b\u5199\u84dd\u9cb8\u5e73\u53f0\u7684\u4e3b\u57df\u540d\u5c31\u53ef\u4ee5\u4e86 1 certbot certonly --email \u90ae\u7bb1\u5730\u5740 -d *.\u5e73\u53f0\u4e3b\u57df\u540d --manual --preferred-challenges dns --server https://acme-v02.api.letsencrypt.org/directory \u5728\u57df\u540d\u63a7\u5236\u53f0\uff0c\u5c06\u4e0b\u9762\u7684TXT\u683c\u5f0f\u7684\u89e3\u6790\u548c\u57df\u540d\u505a\u4e2a\u89e3\u6790\uff0c\u8fd9\u662f\u57df\u540d\u6240\u5c5e\u6743\u7684\u6821\u9a8c \u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662fTXT\u89e3\u6790\uff0c\u89e3\u6790\u503c\u9700\u8981\u52a0\u4e0a\u53cc\u5f15\u53f7\uff08\u7ecf\u6d4b\u8bd5\uff0c\u534e\u4e3a\u57df\u540d\u89e3\u6790\u9700\u8981\u52a0\u53cc\u5f15\u53f7\uff0c\u963f\u91cc\u57df\u540d\u89e3\u6790\u5219\u4e0d\u9700\u8981\uff09 \u89e3\u6790\u5b8c\u6210\u4ee5\u540e\uff0c\u76f4\u63a5\u56de\u8f66\uff0c\u6821\u9a8c\u6ca1\u95ee\u9898\u7684\u8bdd\uff0c\u4f1a\u8fd4\u56de\u8bc1\u4e66\u5728\u670d\u52a1\u5668\u7684\u4f4d\u7f6e\u548c\u5230\u671f\u65f6\u95f4\uff0c\u56e0\u4e3a\u8fd9\u662f\u514d\u8d39\u7684\uff0c\u6240\u4ee5\u4f7f\u7528\u671f\u9650\u53ea\u67093\u4e2a\u6708\uff0c\u540e\u9762\u4f1a\u4ecb\u7ecd\u81ea\u52a8\u7eed\u8d39\u7684\u65b9\u5f0f 4. \u8bc1\u4e66\u7eed\u8d39\uff08\u81ea\u52a8\u7eed\u8d39\uff09 \u00b6 \u5176\u5b9e\u7eed\u8d39\u5f88\u7b80\u5355\uff0c\u6d41\u7a0b\u548c\u7533\u8bf7\u4e00\u6837\uff1a 1 2 certbot renew --cert-name zkmlops.com # \u8bc1\u4e66\u6709\u6548\u671f\u5c0f\u4e8e30\u5929\u624d\u4f1arenew certbot renew --force-renewal --cert-name zkmlops.com # \u5f3a\u884crenew \u4f46\u662f\u6bcf\u6b21\u90fd\u9700\u8981\u624b\u52a8\u66f4\u65b0\u57df\u540d\u89e3\u6790\u7684\u503c\uff0c\u8fd9\u5f88\u4e0d\u201c\u8fd0\u7ef4\u201d\uff0c\u6211\u60f3\u8ba9\u4ed6\u53ef\u4ee5\u81ea\u5df1\u66f4\u65b0\u57df\u540d\u89e3\u6790\u3002\u5404\u79cd\u7ffb\u9605\u8d44\u6599\uff0c\u67e5\u8be2\u534e\u4e3aAPI\u6587\u6863\u540e\uff0c\u771f\u88ab\u6211\u6363\u9f13\u51fa\u6765\u4e86\uff0c\u76f4\u63a5\u653e\u4ee3\u7801\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 #!/usr/bin/env python from huaweicloudsdkcore.auth.credentials import BasicCredentials from huaweicloudsdkcore.exceptions import exceptions from huaweicloudsdkdns.v2.region.dns_region import DnsRegion from huaweicloudsdkdns.v2 import * import os domain = os . environ [ \"CERTBOT_DOMAIN\" ] value = os . environ [ \"CERTBOT_VALIDATION\" ] ak = \"\" sk = \"\" credentials = BasicCredentials ( ak , sk ) client = DnsClient . new_builder () \\ . with_credentials ( credentials ) \\ . with_region ( DnsRegion . value_of ( \"cn-east-3\" )) \\ . build () try : request = UpdateRecordSetRequest () request . zone_id = \"\" # \u81ea\u5df1\u5728\u63a7\u5236\u53f0\u67e5 request . recordset_id = \"\" # \u81ea\u5df1\u5728\u63a7\u5236\u53f0\u67e5 listUpdateRecordSetReqRecordsbody = [ ' \\\" ' + value + ' \\\" ' ] request . body = UpdateRecordSetReq ( records = listUpdateRecordSetReqRecordsbody , type = \"TXT\" , name = \"_acme-challenge.xxxxx.com.\" ) response = client . update_record_set ( request ) print ( response ) except exceptions . ClientRequestException as e : print ( e . status_code ) print ( e . request_id ) print ( e . error_code ) print ( e . error_msg ) \u56e0\u4e3a\u6211\u7684\u57df\u540d\u662f\u5728\u534e\u4e3a\u4e0a\u7533\u8bf7\u7684\uff0c\u6240\u4ee5\u6211\u53ea\u6363\u9f13\u51fa\u4e86\u534e\u4e3a\u7684\u811a\u672c\uff0c\u963f\u91cc\u7684\u811a\u672c\u4f60\u4eec\u81ea\u5df1\u6363\u9f13\u5427\uff1a - \u534e\u4e3aAPI\u8c03\u8bd5\u63a7\u5236\u53f0\uff1ahttps://apiexplorer.developer.huaweicloud.com/apiexplorer/sdk?product=DNS&api=ListRecordSets - \u963f\u91ccAPI\u8c03\u8bd5\u63a7\u5236\u53f0\uff1a\uff1ahttps://next.api.aliyun.com/api-tools/sdk/Alidns?version=2015-01-09&language=python-tea \u6709\u4e86\u811a\u672c\u6211\u4eec\u7eed\u8d39\u5c31\u53ef\u4ee5\u4f7f\u7528\u811a\u672c\u6765\u5e2e\u6211\u4eec\u4fee\u6539\u89e3\u6790\u4e86 certbot renew --cert-name chenshanb3.com --manual-auth-hook /path/to/certbot_renew_hw.py \u4e5f\u53ef\u4ee5\u52a0\u5165\u5b9a\u65f6\u4efb\u52a1 0 0 15 * * certbot renew --cert-name chenshanb3.com --manual-auth-hook /path/to/certbot_renew_hw.py \u57df\u540d\u7eed\u8d39\u4ee5\u540e\uff0c\u5c31\u4e0d\u9700\u8981\u90a3\u4e48\u590d\u6742\u7684\u64cd\u4f5c\u4e86\uff0c\u66f4\u6362\u4e2d\u63a7\u673a\u4e0a\u7684\u8bc1\u4e66\u4ee5\u540e\uff0c\u6267\u884c\u4e0b\u9762\u76844\u6761\u547d\u4ee4\u5c31\u53ef\u4ee5\u4e86\uff1a 1 2 3 4 ./bkcli sync cert ./bkcli install cert ./bkcli restart nginx /data/src/ci/scripts/bk-ci-utils-https.sh https \u603b\u7ed3 \u00b6 \u867d\u7136\u6bcf\u4e09\u4e2a\u6708\u7eed\u8d39\u4e00\u6b21\u5f88\u9ebb\u70e6\uff0c\u4f46\u662f\u67b6\u4e0d\u4f4f\u514d\u8d39\u5440\uff0c\u5728\u4e13\u4e1a\u673a\u6784\u7533\u8bf7\u8bc1\u4e66\u52a8\u4e0d\u52a8\u5c31\u662f\u51e0\u4e07\u3001\u51e0\u5341\u4e07\uff0c\u4f7f\u7528\u514d\u8d39\u7684\uff0c\u8fd0\u7ef4\u6210\u672c\u4e0d\u5c31\u964d\u4e0b\u6765\u4e86\uff08\u624b\u52a8\u6ed1\u7a3d\uff09\uff5e\uff5e\uff5e \u5e02\u9762\u4e0a\u8fd8\u6709\u5f88\u591a\u57df\u540d\u7533\u8bf7\u7684\u8f6f\u4ef6\u548c\u670d\u52a1\uff0c\u6bd4\u5982\u201c\u5b9d\u5854\u9762\u677f\u201d\uff0c\u5b98\u7f51\u5730\u5740\uff1ahttps://www.bt.cn/new/index.html\uff0c\u6211\u4e5f\u5b89\u88c5\u4f53\u9a8c\u4e86\u4e00\u4e0b\uff0c\u4ee5\u4e0b\u89c2\u70b9\u53ea\u4ee3\u8868\u6211\u4e2a\u4eba\uff1a 1. \u9700\u8981\u6ce8\u518c\u624d\u80fd\u8fdb\u5165\u9762\u677f\u4f7f\u7528 2. \u90fd\u662f\u6536\u8d39\u7684\uff0c\u552f\u4e00\u514d\u8d39\u7528\u7684\u4e5f\u662fLet\u2019s Encrypt\u514d\u8d39\u8bc1\u4e66 \u6240\u4ee5\u6211\u653e\u5f03\u4f7f\u7528\u5b9d\u5854\u9762\u677f \u5982\u679c\u4f60\u6709\u66f4\u597d\u7684\u57df\u540d\u7533\u8bf7\u65b9\u5f0f\uff0c\u6b22\u8fce\u63a8\u8350\uff5e\uff5e\uff5e\uff5e \uff08\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4e00\u53f0\u670d\u52a1\u5668\u53ea\u80fd\u7ed95\u4e2a\u57df\u540d\u7533\u8bf7\u8bc1\u4e66\uff0c\u6bcf\u5929\u7533\u8bf7\u7684\u6b21\u6570\u4e5f\u6709\u9650\u5236\uff0c\u7533\u8bf7\u5b8c\u6210\u4ee5\u540e\uff0c\u522b\u591a\u6b21\u6d4b\u8bd5\uff0c\u4e0d\u7136\u4f60\u5c31\u53ea\u80fd\u6362\u53f0\u670d\u52a1\u5668\u4e86\u3002snap\u548ccertbot\u90fd\u662f\u56fd\u5916\u7684\u8f6f\u4ef6\uff0c\u6240\u4ee5\u61c2\u7684\u90fd\u61c2\uff0c\u5b89\u88c5\u8fc7\u7a0b\u53ef\u80fd\u4f1a\u6709\u70b9\u6162\uff0c\u8010\u5fc3\u7b49\u5f85\u5c31\u53ef\u4ee5\u4e86\uff09","title":"\u7533\u8bf7SSL\u8bc1\u4e66"},{"location":"opsbasis/https/#_1","text":"HTTP\u534f\u8bae\u662f\u8d85\u6587\u672c\u4f20\u8f93\u534f\u8bae\u7684\u7f29\u5199\uff0c\u82f1\u6587\u662fHyper Text Transfer Protocol\u3002\u5b83\u662f\u4eceWEB\u670d\u52a1\u5668\u4f20\u8f93\u8d85\u6587\u672c\u6807\u8bb0\u8bed\u8a00(HTML)\u5230\u672c\u5730\u6d4f\u89c8\u5668\u7684\u4f20\u9001\u534f\u8bae\uff0cHTTP\u4fe1\u606f\u662f\u660e\u6587\u4f20\u8f93\uff0cHTTPS\u5219\u662f\u5177\u6709\u5b89\u5168\u6027\u7684ssl/tls\u52a0\u5bc6\u4f20\u8f93\u534f\u8bae\u3002HTTP\u7684\u8fde\u63a5\u5f88\u7b80\u5355\uff0c\u662f\u65e0\u72b6\u6001\u7684\uff1bHTTPS\u534f\u8bae\u662f\u7531SSL/TLS+HTTP\u534f\u8bae\u6784\u5efa\u7684\u53ef\u8fdb\u884c\u52a0\u5bc6\u4f20\u8f93\u3001\u8eab\u4efd\u8ba4\u8bc1\u7684\u7f51\u7edc\u534f\u8bae\uff0c\u6bd4HTTP\u534f\u8bae\u5b89\u5168\uff0c\u5b98\u65b9\u6587\u6863\u5df2\u7ecf\u6709\u5207\u6362HTTPS\u7684\u6307\u5bfc\u624b\u518c\u4e86 http\u5207\u6362https ,\u6211\u4e3a\u4ec0\u4e48\u4f1a\u5728\u8fd9\u91cc\u591a\u6b64\u4e00\u4e3e\u5462\uff0c\u662f\u56e0\u4e3a\u4f7f\u7528\u670d\u52a1\u5668\u751f\u6210\u7684\u8bc1\u4e66\u5728\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u6d4f\u89c8\u5668\u4f1a\u63d0\u793a\u4e0d\u5b89\u5168\uff0c\u8bc1\u4e66\u4e0d\u53ef\u4fe1\uff0c\u5177\u4f53\u7684\u539f\u56e0\u53ef\u4ee5\u81ea\u884c\u641c\u7d22\u4e00\u4e0b\uff08\u53ef\u4fe1\u7684CA\u673a\u6784\uff09\u3002 \u4eca\u5929\u5728\u8fd9\u91cc\u5c31\u4ecb\u7ecd\u4e00\u6b3e\u5b89\u5168\u3001\u53ef\u88ab\u6d4f\u89c8\u5668\u4fe1\u4efb\u7684\u8bc1\u4e66\uff1aLet\u2019s Encrypt\u514d\u8d39\u8bc1\u4e66","title":"\u524d\u8a00"},{"location":"opsbasis/https/#_2","text":"\u4e00\u53f0\u53ef\u4ee5\u8bbf\u95ee\u4e92\u8054\u7f51\u7684\u670d\u52a1\u5668\uff08\u6700\u4f4e\u914d\u7f6e\uff1a2C/2G\uff09","title":"\u51c6\u5907\u5de5\u4f5c"},{"location":"opsbasis/https/#_3","text":"","title":"\u7533\u8bf7\u8bc1\u4e66"},{"location":"opsbasis/https/#1-snapd","text":"1 sudo yum install epel-release -y 1 sudo yum install snapd -y 1 sudo systemctl enable --now snapd.socket 1 2 sudo service snapd start sudo ln -s /var/lib/snapd/snap /snap","title":"1. \u5b89\u88c5snapd"},{"location":"opsbasis/https/#2-certbot","text":"1 sudo snap install core 1 sudo snap refresh core 1 sudo snap install --classic certbot 1 sudo ln -s /snap/bin/certbot /usr/bin/certbot \u81f3\u6b64certbot\u5b89\u88c5\u5df2\u5b8c\u6210\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u7533\u8bf7\u8bc1\u4e66\u4e86","title":"2. \u5b89\u88c5certbot"},{"location":"opsbasis/https/#3","text":"\u8fd9\u662f\u4f7f\u7528\u7684\u662f\u6cdb\u89e3\u6790\u57df\u540d\uff0c\u586b\u5199\u84dd\u9cb8\u5e73\u53f0\u7684\u4e3b\u57df\u540d\u5c31\u53ef\u4ee5\u4e86 1 certbot certonly --email \u90ae\u7bb1\u5730\u5740 -d *.\u5e73\u53f0\u4e3b\u57df\u540d --manual --preferred-challenges dns --server https://acme-v02.api.letsencrypt.org/directory \u5728\u57df\u540d\u63a7\u5236\u53f0\uff0c\u5c06\u4e0b\u9762\u7684TXT\u683c\u5f0f\u7684\u89e3\u6790\u548c\u57df\u540d\u505a\u4e2a\u89e3\u6790\uff0c\u8fd9\u662f\u57df\u540d\u6240\u5c5e\u6743\u7684\u6821\u9a8c \u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662fTXT\u89e3\u6790\uff0c\u89e3\u6790\u503c\u9700\u8981\u52a0\u4e0a\u53cc\u5f15\u53f7\uff08\u7ecf\u6d4b\u8bd5\uff0c\u534e\u4e3a\u57df\u540d\u89e3\u6790\u9700\u8981\u52a0\u53cc\u5f15\u53f7\uff0c\u963f\u91cc\u57df\u540d\u89e3\u6790\u5219\u4e0d\u9700\u8981\uff09 \u89e3\u6790\u5b8c\u6210\u4ee5\u540e\uff0c\u76f4\u63a5\u56de\u8f66\uff0c\u6821\u9a8c\u6ca1\u95ee\u9898\u7684\u8bdd\uff0c\u4f1a\u8fd4\u56de\u8bc1\u4e66\u5728\u670d\u52a1\u5668\u7684\u4f4d\u7f6e\u548c\u5230\u671f\u65f6\u95f4\uff0c\u56e0\u4e3a\u8fd9\u662f\u514d\u8d39\u7684\uff0c\u6240\u4ee5\u4f7f\u7528\u671f\u9650\u53ea\u67093\u4e2a\u6708\uff0c\u540e\u9762\u4f1a\u4ecb\u7ecd\u81ea\u52a8\u7eed\u8d39\u7684\u65b9\u5f0f","title":"3. \u8bc1\u4e66\u7533\u8bf7"},{"location":"opsbasis/https/#4","text":"\u5176\u5b9e\u7eed\u8d39\u5f88\u7b80\u5355\uff0c\u6d41\u7a0b\u548c\u7533\u8bf7\u4e00\u6837\uff1a 1 2 certbot renew --cert-name zkmlops.com # \u8bc1\u4e66\u6709\u6548\u671f\u5c0f\u4e8e30\u5929\u624d\u4f1arenew certbot renew --force-renewal --cert-name zkmlops.com # \u5f3a\u884crenew \u4f46\u662f\u6bcf\u6b21\u90fd\u9700\u8981\u624b\u52a8\u66f4\u65b0\u57df\u540d\u89e3\u6790\u7684\u503c\uff0c\u8fd9\u5f88\u4e0d\u201c\u8fd0\u7ef4\u201d\uff0c\u6211\u60f3\u8ba9\u4ed6\u53ef\u4ee5\u81ea\u5df1\u66f4\u65b0\u57df\u540d\u89e3\u6790\u3002\u5404\u79cd\u7ffb\u9605\u8d44\u6599\uff0c\u67e5\u8be2\u534e\u4e3aAPI\u6587\u6863\u540e\uff0c\u771f\u88ab\u6211\u6363\u9f13\u51fa\u6765\u4e86\uff0c\u76f4\u63a5\u653e\u4ee3\u7801\uff1a 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 #!/usr/bin/env python from huaweicloudsdkcore.auth.credentials import BasicCredentials from huaweicloudsdkcore.exceptions import exceptions from huaweicloudsdkdns.v2.region.dns_region import DnsRegion from huaweicloudsdkdns.v2 import * import os domain = os . environ [ \"CERTBOT_DOMAIN\" ] value = os . environ [ \"CERTBOT_VALIDATION\" ] ak = \"\" sk = \"\" credentials = BasicCredentials ( ak , sk ) client = DnsClient . new_builder () \\ . with_credentials ( credentials ) \\ . with_region ( DnsRegion . value_of ( \"cn-east-3\" )) \\ . build () try : request = UpdateRecordSetRequest () request . zone_id = \"\" # \u81ea\u5df1\u5728\u63a7\u5236\u53f0\u67e5 request . recordset_id = \"\" # \u81ea\u5df1\u5728\u63a7\u5236\u53f0\u67e5 listUpdateRecordSetReqRecordsbody = [ ' \\\" ' + value + ' \\\" ' ] request . body = UpdateRecordSetReq ( records = listUpdateRecordSetReqRecordsbody , type = \"TXT\" , name = \"_acme-challenge.xxxxx.com.\" ) response = client . update_record_set ( request ) print ( response ) except exceptions . ClientRequestException as e : print ( e . status_code ) print ( e . request_id ) print ( e . error_code ) print ( e . error_msg ) \u56e0\u4e3a\u6211\u7684\u57df\u540d\u662f\u5728\u534e\u4e3a\u4e0a\u7533\u8bf7\u7684\uff0c\u6240\u4ee5\u6211\u53ea\u6363\u9f13\u51fa\u4e86\u534e\u4e3a\u7684\u811a\u672c\uff0c\u963f\u91cc\u7684\u811a\u672c\u4f60\u4eec\u81ea\u5df1\u6363\u9f13\u5427\uff1a - \u534e\u4e3aAPI\u8c03\u8bd5\u63a7\u5236\u53f0\uff1ahttps://apiexplorer.developer.huaweicloud.com/apiexplorer/sdk?product=DNS&api=ListRecordSets - \u963f\u91ccAPI\u8c03\u8bd5\u63a7\u5236\u53f0\uff1a\uff1ahttps://next.api.aliyun.com/api-tools/sdk/Alidns?version=2015-01-09&language=python-tea \u6709\u4e86\u811a\u672c\u6211\u4eec\u7eed\u8d39\u5c31\u53ef\u4ee5\u4f7f\u7528\u811a\u672c\u6765\u5e2e\u6211\u4eec\u4fee\u6539\u89e3\u6790\u4e86 certbot renew --cert-name chenshanb3.com --manual-auth-hook /path/to/certbot_renew_hw.py \u4e5f\u53ef\u4ee5\u52a0\u5165\u5b9a\u65f6\u4efb\u52a1 0 0 15 * * certbot renew --cert-name chenshanb3.com --manual-auth-hook /path/to/certbot_renew_hw.py \u57df\u540d\u7eed\u8d39\u4ee5\u540e\uff0c\u5c31\u4e0d\u9700\u8981\u90a3\u4e48\u590d\u6742\u7684\u64cd\u4f5c\u4e86\uff0c\u66f4\u6362\u4e2d\u63a7\u673a\u4e0a\u7684\u8bc1\u4e66\u4ee5\u540e\uff0c\u6267\u884c\u4e0b\u9762\u76844\u6761\u547d\u4ee4\u5c31\u53ef\u4ee5\u4e86\uff1a 1 2 3 4 ./bkcli sync cert ./bkcli install cert ./bkcli restart nginx /data/src/ci/scripts/bk-ci-utils-https.sh https","title":"4. \u8bc1\u4e66\u7eed\u8d39\uff08\u81ea\u52a8\u7eed\u8d39\uff09"},{"location":"opsbasis/https/#_4","text":"\u867d\u7136\u6bcf\u4e09\u4e2a\u6708\u7eed\u8d39\u4e00\u6b21\u5f88\u9ebb\u70e6\uff0c\u4f46\u662f\u67b6\u4e0d\u4f4f\u514d\u8d39\u5440\uff0c\u5728\u4e13\u4e1a\u673a\u6784\u7533\u8bf7\u8bc1\u4e66\u52a8\u4e0d\u52a8\u5c31\u662f\u51e0\u4e07\u3001\u51e0\u5341\u4e07\uff0c\u4f7f\u7528\u514d\u8d39\u7684\uff0c\u8fd0\u7ef4\u6210\u672c\u4e0d\u5c31\u964d\u4e0b\u6765\u4e86\uff08\u624b\u52a8\u6ed1\u7a3d\uff09\uff5e\uff5e\uff5e \u5e02\u9762\u4e0a\u8fd8\u6709\u5f88\u591a\u57df\u540d\u7533\u8bf7\u7684\u8f6f\u4ef6\u548c\u670d\u52a1\uff0c\u6bd4\u5982\u201c\u5b9d\u5854\u9762\u677f\u201d\uff0c\u5b98\u7f51\u5730\u5740\uff1ahttps://www.bt.cn/new/index.html\uff0c\u6211\u4e5f\u5b89\u88c5\u4f53\u9a8c\u4e86\u4e00\u4e0b\uff0c\u4ee5\u4e0b\u89c2\u70b9\u53ea\u4ee3\u8868\u6211\u4e2a\u4eba\uff1a 1. \u9700\u8981\u6ce8\u518c\u624d\u80fd\u8fdb\u5165\u9762\u677f\u4f7f\u7528 2. \u90fd\u662f\u6536\u8d39\u7684\uff0c\u552f\u4e00\u514d\u8d39\u7528\u7684\u4e5f\u662fLet\u2019s Encrypt\u514d\u8d39\u8bc1\u4e66 \u6240\u4ee5\u6211\u653e\u5f03\u4f7f\u7528\u5b9d\u5854\u9762\u677f \u5982\u679c\u4f60\u6709\u66f4\u597d\u7684\u57df\u540d\u7533\u8bf7\u65b9\u5f0f\uff0c\u6b22\u8fce\u63a8\u8350\uff5e\uff5e\uff5e\uff5e \uff08\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4e00\u53f0\u670d\u52a1\u5668\u53ea\u80fd\u7ed95\u4e2a\u57df\u540d\u7533\u8bf7\u8bc1\u4e66\uff0c\u6bcf\u5929\u7533\u8bf7\u7684\u6b21\u6570\u4e5f\u6709\u9650\u5236\uff0c\u7533\u8bf7\u5b8c\u6210\u4ee5\u540e\uff0c\u522b\u591a\u6b21\u6d4b\u8bd5\uff0c\u4e0d\u7136\u4f60\u5c31\u53ea\u80fd\u6362\u53f0\u670d\u52a1\u5668\u4e86\u3002snap\u548ccertbot\u90fd\u662f\u56fd\u5916\u7684\u8f6f\u4ef6\uff0c\u6240\u4ee5\u61c2\u7684\u90fd\u61c2\uff0c\u5b89\u88c5\u8fc7\u7a0b\u53ef\u80fd\u4f1a\u6709\u70b9\u6162\uff0c\u8010\u5fc3\u7b49\u5f85\u5c31\u53ef\u4ee5\u4e86\uff09","title":"\u603b\u7ed3"},{"location":"opsbasis/mad/","text":"\u4ec0\u4e48\u662f\u7edf\u4e00\u8eab\u4efd\u8ba4\u8bc1 \u968f\u7740\u4fe1\u606f\u6280\u672f\u548c\u7f51\u7edc\u6280\u672f\u7684\u8fc5\u731b\u53d1\u5c55\uff0c\u4f01\u4e1a\u5185\u90e8\u7684\u5e94\u7528\u7cfb\u7edf\u8d8a\u6765\u8d8a\u591a\u3002\u6bd4\u5982\u5728\u5a92\u4f53\u884c\u4e1a\uff0c\u5e38\u89c1\u7684\u5e94\u7528\u7cfb\u7edf\u5c31\u6709\u91c7\u7f16\u7cfb\u7edf\u3001\u6392\u7248\u7cfb\u7edf\u3001\u5370\u5237\u7cfb\u7edf\u3001\u5e7f\u544a\u7ba1\u7406\u7cfb \u7edf\u3001\u8d22\u52a1\u7cfb\u7edf\u3001\u529e\u516c\u81ea\u52a8\u5316\u7cfb\u7edf\u3001\u51b3\u7b56\u652f\u6301\u7cfb\u7edf\u3001\u5ba2\u6237\u5173\u7cfb\u7ba1\u7406\u7cfb\u7edf\u548c\u7f51\u7ad9\u53d1\u5e03\u7cfb\u7edf\u7b49\u3002\u7531\u4e8e\u8fd9\u4e9b\u7cfb\u7edf\u4e92\u76f8\u72ec\u7acb\uff0c\u7528\u6237\u5728\u4f7f\u7528\u6bcf\u4e2a\u5e94\u7528\u7cfb\u7edf\u4e4b\u524d\u90fd\u5fc5\u987b\u6309\u7167 \u76f8\u5e94\u7684\u7cfb\u7edf\u8eab\u4efd\u8fdb\u884c\u767b\u5f55\uff0c\u4e3a\u6b64\u7528\u6237\u5fc5\u987b\u8bb0\u4f4f\u6bcf\u4e00\u4e2a\u7cfb\u7edf\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u8fd9\u7ed9\u7528\u6237\u5e26\u6765\u4e86\u4e0d\u5c11\u9ebb\u70e6\u3002\u7279\u522b\u662f\u968f\u7740\u7cfb\u7edf\u7684\u589e\u591a\uff0c\u51fa\u9519\u7684\u53ef\u80fd\u6027\u5c31\u4f1a\u589e\u52a0\uff0c\u53d7 \u5230\u975e\u6cd5\u622a\u83b7\u548c\u7834\u574f\u7684\u53ef\u80fd\u6027\u4e5f\u4f1a\u589e\u5927\uff0c\u5b89\u5168\u6027\u5c31\u4f1a\u76f8\u5e94\u964d\u4f4e\u3002\u9488\u5bf9\u4e8e\u8fd9\u79cd\u60c5\u51b5\uff0c\u7edf\u4e00\u7528\u6237\u8ba4\u8bc1\u3001\u5355\u70b9\u767b\u5f55\u7b49\u6982\u5ff5\u5e94\u8fd0\u800c\u751f\uff0c\u540c\u65f6\u4e0d\u65ad\u5730\u88ab\u5e94\u7528\u5230\u4f01\u4e1a\u5e94\u7528\u7cfb \u7edf\u4e2d\u3002 \u6240\u8c13\u8eab\u4efd\u8ba4\u8bc1\uff0c\u5c31\u662f\u5224\u65ad\u4e00\u4e2a\u7528\u6237\u662f\u5426\u4e3a\u5408\u6cd5\u7528\u6237\u7684\u5904\u7406\u8fc7\u7a0b\u3002\u6700\u5e38\u7528\u7684\u7b80\u5355\u8eab\u4efd\u8ba4\u8bc1\u65b9\u5f0f\u662f\u7cfb\u7edf\u901a\u8fc7\u6838\u5bf9\u7528\u6237\u8f93\u5165\u7684\u7528\u6237\u540d\u548c\u53e3\u4ee4\uff0c\u770b\u5176\u662f\u5426\u4e0e\u7cfb\u7edf\u4e2d\u5b58 \u50a8\u7684\u8be5\u7528\u6237\u7684\u7528\u6237\u540d\u548c\u53e3\u4ee4\u4e00\u81f4\uff0c\u6765\u5224\u65ad\u7528\u6237\u8eab\u4efd\u662f\u5426\u6b63\u786e\u3002\u590d\u6742\u4e00\u4e9b\u7684\u8eab\u4efd\u8ba4\u8bc1\u65b9\u5f0f\u91c7\u7528\u4e00\u4e9b\u8f83\u590d\u6742\u7684\u52a0\u5bc6\u7b97\u6cd5\u4e0e\u534f\u8bae\uff0c\u9700\u8981\u7528\u6237\u51fa\u793a\u66f4\u591a\u7684\u4fe1\u606f(\u5982\u79c1\u94a5) \u6765\u8bc1\u660e\u81ea\u5df1\u7684\u8eab\u4efd\uff0c\u5982Kerberos\u8eab\u4efd\u8ba4\u8bc1\u7cfb\u7edf\u3002 \u8eab\u4efd\u8ba4\u8bc1\u4e00\u822c\u4e0e\u6388\u6743\u63a7\u5236\u662f\u76f8\u4e92\u8054\u7cfb\u7684\uff0c\u6388\u6743\u63a7\u5236\u662f\u6307\u4e00\u65e6\u7528\u6237\u7684\u8eab\u4efd\u901a\u8fc7\u8ba4\u8bc1\u4ee5\u540e\uff0c\u786e\u5b9a\u54ea\u4e9b\u8d44\u6e90\u8be5\u7528\u6237\u53ef\u4ee5\u8bbf\u95ee\u3001\u53ef\u4ee5\u8fdb\u884c\u4f55\u79cd\u65b9\u5f0f\u7684\u8bbf\u95ee\u64cd\u4f5c\u7b49\u95ee \u9898\u3002\u5728\u4e00\u4e2a\u6570\u5b57\u5316\u7684\u5de5\u4f5c\u4f53\u7cfb\u4e2d\uff0c\u5e94\u8be5\u6709\u4e00\u4e2a\u7edf\u4e00\u7684\u8eab\u4efd\u8ba4\u8bc1\u7cfb\u7edf\u4f9b\u5404\u5e94\u7528\u7cfb\u7edf\u4f7f\u7528\uff0c\u4f46\u6388\u6743\u63a7\u5236\u53ef\u4ee5\u7531\u5404\u5e94\u7528\u7cfb\u7edf\u81ea\u5df1\u7ba1\u7406\u3002 \u4e3a\u4ec0\u4e48\u9700\u8981\u7edf\u4e00\u8ba4\u8bc1 \u901a\u8fc7\u4ee5\u4e0a\u4e24\u5f20\u56fe\uff0c\u53ef\u4ee5\u5f88\u6e05\u695a\u7684\u770b\u51fa\uff0c\u4f7f\u7528\u7edf\u4e00\u8ba4\u8bc1\u4ee5\u540e\uff1a 1.\u4f7f\u7528\u7b80\u5355\uff0c\u4f7f\u7528\u8005\u4e0d\u9700\u8981\u8bb0\u5f55\u591a\u5957\u8d26\u53f7\u5bc6\u7801\uff1b 2.\u7ba1\u7406\u7b80\u5355\uff0c\u7ba1\u7406\u8005\u53ea\u9700\u8981\u7ba1\u7406\u4e00\u5957\u7528\u6237\u4fe1\u606f\uff1b \u7ec4\u4ef6\u4ecb\u7ecd \u00b6 \u524d\u7aef\u4f7f\u7528\u7684\u662f\u5f00\u6e90\u7684Vue\u6a21\u7248 vue-admin-template \u540e\u7aef\u4f7f\u7528\u7684\u662fDjango rest-framework \u6846\u67b6 python\u7248\u672c\uff1a3.8.5\u4ee5\u53ca\u4ee5\u4e0a \u90e8\u7f72\u624b\u518c \u00b6 \u524d\u540e\u7aef\u4ee3\u7801\u5730\u5740: github 1. \u4fee\u6539\u540e\u7aef\u914d\u7f6e\u6587\u4ef6 settings.py \u00b6 \u4fee\u6539\u6570\u636e\u5e93\u8fde\u63a5 \u4fee\u6539LDAP\u76f8\u5173\u7684\u4fe1\u606f \u914d\u7f6e\u8de8\u57df\u8bbf\u95ee\u767d\u540d\u5355 2.\u4f7f\u7528uwsgi\u90e8\u7f72\u540e\u7aef \u00b6 runserver -- start a lightweight web server for development, runserver\u53ea\u80fd\u4f7f\u7528\u4e8e\u5f00\u53d1\u6d4b\u8bd5\u9a8c\u8bc1\uff0c\u90e8\u7f72\u5230\u751f\u4ea7\u73af\u5883\u5efa\u8bae\u4f7f\u7528uwsgi\uff0c\u672c\u5de5\u7a0b\u7684uwsgi\u5df2\u7ecf\u914d\u7f6e\u597d\u4e86\uff0c\u76f8\u5173\u7aef\u53e3\u5c3d\u91cf\u4fdd\u6301\u4e0d\u53d8\u3002 1 2 3 4 5 python3 manage.py makemigrations python3 manage.py migrate pip3 install uwsgi # \u4e00\u5b9a\u8981\u7528pip\u5b89\u88c5\uff0c\u4f7f\u7528yum\u6216\u8005apt\u5b89\u88c5\u4f1a\u542f\u52a8\u62a5\u9519 uwsgi --ini uwsgi.ini # \u542f\u52a8 uwsgi --stop uwsgi.pid # \u505c\u6b62 3. \u4f7f\u7528nginx\u90e8\u7f72\u524d\u7aef \u00b6 \u524d\u7aef\u90e8\u7f72\u5305\uff0c\u901a\u5e38\u653e\u5728nignx/html\u76ee\u5f55\u4e0b \u914d\u7f6e\u6587\u4ef6\u5982\u4e0b 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 server { listen 5000 ; # 5000\u7aef\u53e3\u4e0d\u80fd\u6539\uff0c\u524d\u7aef\u5df2\u7ecf\u5199\u6b7b\u4e86\u7aef\u53e3 server_name localhost ; location / { include uwsgi_params ; #uwsgi_modifier1 72; uwsgi_pass unix:/data/userscenter/uwsgi.sock ; uwsgi_param UWSGI_SCRIPT userscenter.wsgi ; uwsgi_param UWSGI_CHDIR /data/userscenter ; index index.html index.htm ; client_max_body_size 35m ; access_log logs/uwsgi.log ; error_log logs/uwsgi.error error ; } } server { listen 80 ; server_name localhost ; client_max_body_size 1024m ; client_body_buffer_size 512k ; proxy_connect_timeout 1800 ; proxy_read_timeout 1800 ; proxy_send_timeout 1800 ; proxy_buffer_size 128k ; proxy_buffers 32 128k ; proxy_busy_buffers_size 128k ; proxy_temp_file_write_size 512k ; gzip on ; gzip_buffers 4 16k ; gzip_http_version 1 .0 ; gzip_comp_level 5 ; gzip_vary on ; charset utf-8,gbk ; access_log off ; location / { root html/dist ; # dist\u5b58\u653e\u7684\u8def\u5f84 index index.html ; } } \u542f\u52a8nginx\u4ee5\u540e\uff0c\u8bbf\u95eeip+80\u7aef\u53e3\u5373\u53ef\u3002 FAQ \u00b6 1. MAD\u57df\u8d26\u53f7\u8bbe\u7f6essl\u8bc1\u4e66\u8bbf\u95ee \u00b6 \u5f88\u591a\u4eba\u5728\u4f7f\u7528\u65f6\u5019\uff0c\u53ea\u80fd\u4f7f\u7528389\u7aef\u53e3\uff0c636\u7aef\u53e3\u4f1a\u63d0\u793assl\u8bc1\u4e66\u9519\u8bef\uff0c\u4e0b\u9762\u6559\u5927\u5bb6\u5982\u4f55\u8bbe\u7f6eAD\u57df\u3002 \u521b\u5efa\u8bc1\u4e66\u9881\u53d1\u673a\u6784,\u6dfb\u52a0Active Directory \u8bc1\u4e66\u670d\u52a1 \u89d2\u8272 \u914d\u7f6e\u57df\u8bc1\u4e66 \u70b9\u51fb\u901a\u77e5-\u914d\u7f6e\u76ee\u6807\u670d\u52a1\u5668\u4e0a\u7684Active Directory \u8bc1\u4e66\u670d\u52a1 \u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u91cd\u542f\u4e0b\u670d\u52a1\u5668 \u5728\u8bc1\u4e66\u9881\u53d1\u673a\u6784\u4e2d\u53ef\u4ee5\u770b\u5230\u7ed9\u57df\u63a7\u9881\u53d1\u7684\u8bc1\u4e66 \u5b8c\u6210AD\u91cd\u542f\u540e\uff0c\u5373\u53ef\u4ee5\u8fdb\u884c\u4f7f\u7528VDI 636\u7aef\u53e3\u8fdb\u884c\u5b89\u5168\u8fde\u63a5","title":"LDAP"},{"location":"opsbasis/mad/#_1","text":"\u524d\u7aef\u4f7f\u7528\u7684\u662f\u5f00\u6e90\u7684Vue\u6a21\u7248 vue-admin-template \u540e\u7aef\u4f7f\u7528\u7684\u662fDjango rest-framework \u6846\u67b6 python\u7248\u672c\uff1a3.8.5\u4ee5\u53ca\u4ee5\u4e0a","title":"\u7ec4\u4ef6\u4ecb\u7ecd"},{"location":"opsbasis/mad/#_2","text":"\u524d\u540e\u7aef\u4ee3\u7801\u5730\u5740: github","title":"\u90e8\u7f72\u624b\u518c"},{"location":"opsbasis/mad/#1-settingspy","text":"\u4fee\u6539\u6570\u636e\u5e93\u8fde\u63a5 \u4fee\u6539LDAP\u76f8\u5173\u7684\u4fe1\u606f \u914d\u7f6e\u8de8\u57df\u8bbf\u95ee\u767d\u540d\u5355","title":"1. \u4fee\u6539\u540e\u7aef\u914d\u7f6e\u6587\u4ef6 settings.py"},{"location":"opsbasis/mad/#2uwsgi","text":"runserver -- start a lightweight web server for development, runserver\u53ea\u80fd\u4f7f\u7528\u4e8e\u5f00\u53d1\u6d4b\u8bd5\u9a8c\u8bc1\uff0c\u90e8\u7f72\u5230\u751f\u4ea7\u73af\u5883\u5efa\u8bae\u4f7f\u7528uwsgi\uff0c\u672c\u5de5\u7a0b\u7684uwsgi\u5df2\u7ecf\u914d\u7f6e\u597d\u4e86\uff0c\u76f8\u5173\u7aef\u53e3\u5c3d\u91cf\u4fdd\u6301\u4e0d\u53d8\u3002 1 2 3 4 5 python3 manage.py makemigrations python3 manage.py migrate pip3 install uwsgi # \u4e00\u5b9a\u8981\u7528pip\u5b89\u88c5\uff0c\u4f7f\u7528yum\u6216\u8005apt\u5b89\u88c5\u4f1a\u542f\u52a8\u62a5\u9519 uwsgi --ini uwsgi.ini # \u542f\u52a8 uwsgi --stop uwsgi.pid # \u505c\u6b62","title":"2.\u4f7f\u7528uwsgi\u90e8\u7f72\u540e\u7aef"},{"location":"opsbasis/mad/#3-nginx","text":"\u524d\u7aef\u90e8\u7f72\u5305\uff0c\u901a\u5e38\u653e\u5728nignx/html\u76ee\u5f55\u4e0b \u914d\u7f6e\u6587\u4ef6\u5982\u4e0b 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 server { listen 5000 ; # 5000\u7aef\u53e3\u4e0d\u80fd\u6539\uff0c\u524d\u7aef\u5df2\u7ecf\u5199\u6b7b\u4e86\u7aef\u53e3 server_name localhost ; location / { include uwsgi_params ; #uwsgi_modifier1 72; uwsgi_pass unix:/data/userscenter/uwsgi.sock ; uwsgi_param UWSGI_SCRIPT userscenter.wsgi ; uwsgi_param UWSGI_CHDIR /data/userscenter ; index index.html index.htm ; client_max_body_size 35m ; access_log logs/uwsgi.log ; error_log logs/uwsgi.error error ; } } server { listen 80 ; server_name localhost ; client_max_body_size 1024m ; client_body_buffer_size 512k ; proxy_connect_timeout 1800 ; proxy_read_timeout 1800 ; proxy_send_timeout 1800 ; proxy_buffer_size 128k ; proxy_buffers 32 128k ; proxy_busy_buffers_size 128k ; proxy_temp_file_write_size 512k ; gzip on ; gzip_buffers 4 16k ; gzip_http_version 1 .0 ; gzip_comp_level 5 ; gzip_vary on ; charset utf-8,gbk ; access_log off ; location / { root html/dist ; # dist\u5b58\u653e\u7684\u8def\u5f84 index index.html ; } } \u542f\u52a8nginx\u4ee5\u540e\uff0c\u8bbf\u95eeip+80\u7aef\u53e3\u5373\u53ef\u3002","title":"3. \u4f7f\u7528nginx\u90e8\u7f72\u524d\u7aef"},{"location":"opsbasis/mad/#faq","text":"","title":"FAQ"},{"location":"opsbasis/mad/#1-madssl","text":"\u5f88\u591a\u4eba\u5728\u4f7f\u7528\u65f6\u5019\uff0c\u53ea\u80fd\u4f7f\u7528389\u7aef\u53e3\uff0c636\u7aef\u53e3\u4f1a\u63d0\u793assl\u8bc1\u4e66\u9519\u8bef\uff0c\u4e0b\u9762\u6559\u5927\u5bb6\u5982\u4f55\u8bbe\u7f6eAD\u57df\u3002 \u521b\u5efa\u8bc1\u4e66\u9881\u53d1\u673a\u6784,\u6dfb\u52a0Active Directory \u8bc1\u4e66\u670d\u52a1 \u89d2\u8272 \u914d\u7f6e\u57df\u8bc1\u4e66 \u70b9\u51fb\u901a\u77e5-\u914d\u7f6e\u76ee\u6807\u670d\u52a1\u5668\u4e0a\u7684Active Directory \u8bc1\u4e66\u670d\u52a1 \u914d\u7f6e\u5b8c\u6210\u540e\uff0c\u91cd\u542f\u4e0b\u670d\u52a1\u5668 \u5728\u8bc1\u4e66\u9881\u53d1\u673a\u6784\u4e2d\u53ef\u4ee5\u770b\u5230\u7ed9\u57df\u63a7\u9881\u53d1\u7684\u8bc1\u4e66 \u5b8c\u6210AD\u91cd\u542f\u540e\uff0c\u5373\u53ef\u4ee5\u8fdb\u884c\u4f7f\u7528VDI 636\u7aef\u53e3\u8fdb\u884c\u5b89\u5168\u8fde\u63a5","title":"1. MAD\u57df\u8d26\u53f7\u8bbe\u7f6essl\u8bc1\u4e66\u8bbf\u95ee"}]}